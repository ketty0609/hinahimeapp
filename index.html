<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Hina & Hime é£²é£Ÿæ—¥è¨˜</title>
<style>
body {
    font-family: Arial;
    background: #ffe6f2;
    padding: 15px;
}
.card {
    background: white;
    padding: 15px;
    border-radius: 20px;
    margin-bottom: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
h2 { color:#ff4da6; text-align:center; }
button {
    background:#ff80bf;
    border:none;
    padding:8px;
    border-radius:10px;
    color:white;
    margin-top:5px;
}
input, select {
    width:100%;
    padding:8px;
    margin-top:5px;
    border-radius:8px;
    border:1px solid #ddd;
}
.product-item {
    display:flex;
    justify-content:space-between;
    margin-top:5px;
}
</style>
</head>
<body>

<h2>ğŸŒ¸ Hina & Hime é£²é£Ÿæ—¥è¨˜</h2>

<div class="card">
<h3>ğŸ“¦ ç”¢å“ç®¡ç†</h3>
<input id="pname" placeholder="ç”¢å“åç¨±">
<input id="cal" type="number" placeholder="æ¯100gç†±é‡">
<input id="water" type="number" placeholder="æ°´åˆ†%">
<select id="ptype">
<option value="wet">æ¿•é£Ÿ</option>
<option value="dry">ä¹¾é£Ÿ</option>
</select>
<button onclick="addProduct()">æ–°å¢ç”¢å“</button>
<div id="productManage"></div>
</div>

<div class="card">
<h3>ğŸ½ æ–°å¢é¤µé£Ÿ</h3>
<input type="date" id="mealDate">
<select id="cat">
<option value="hina">Hina</option>
<option value="hime">Hime</option>
</select>
<select id="productList"></select>
<input id="grams" type="number" placeholder="é¤µé£Ÿå…‹æ•¸">
<button onclick="addMeal()">æ–°å¢</button>
</div>

<div class="card">
<h3>ğŸ“… æŸ¥çœ‹ç´€éŒ„</h3>
<input type="date" id="viewDate" onchange="updateStats()">
<div id="stats"></div>
</div>

<script>
let products = JSON.parse(localStorage.getItem("products")) || [];
let meals = JSON.parse(localStorage.getItem("meals")) || [];

const goals = { hina:220, hime:160 };

mealDate.valueAsDate = new Date();
viewDate.valueAsDate = new Date();

function save() {
localStorage.setItem("products", JSON.stringify(products));
localStorage.setItem("meals", JSON.stringify(meals));
}

function addProduct() {
if(!pname.value) return alert("è«‹å¡«ç”¢å“åç¨±");
products.push({
name:pname.value,
cal:Number(cal.value),
water:Number(water.value),
type:ptype.value
});
save();
updateProductList();
updateProductManage();
pname.value="";
}

function deleteProduct(index){
products.splice(index,1);
save();
updateProductList();
updateProductManage();
}

function updateProductList(){
productList.innerHTML="";
products.forEach((p,i)=>{
let opt=document.createElement("option");
opt.value=i;
opt.text=p.name;
productList.appendChild(opt);
});
}

function updateProductManage(){
productManage.innerHTML="";
products.forEach((p,i)=>{
let div=document.createElement("div");
div.className="product-item";
div.innerHTML=`${p.name} <button onclick="deleteProduct(${i})">åˆªé™¤</button>`;
productManage.appendChild(div);
});
}

function addMeal(){
let p=products[productList.value];
if(!p) return alert("è«‹å…ˆæ–°å¢ç”¢å“");
let g=Number(grams.value);
if(!g) return alert("è«‹è¼¸å…¥å…‹æ•¸");

meals.push({
date:mealDate.value,
cat:cat.value,
cal:g/100*p.cal,
water:p.type==="wet"?g*(p.water/100):0
});
save();
updateStats();
grams.value="";
}

function updateStats(){
let date=viewDate.value;
let hinaCal=0,hinaWater=0,himeCal=0,himeWater=0;

meals.filter(m=>m.date===date).forEach(m=>{
if(m.cat==="hina"){
hinaCal+=m.cal;
hinaWater+=m.water;
}else{
himeCal+=m.cal;
himeWater+=m.water;
}
});

stats.innerHTML=`
<strong>Hina</strong><br>
ğŸ”¥ ${Math.round(hinaCal)} / ${goals.hina} kcal<br>
ğŸ’§ ${Math.round(hinaWater)} ml<br><br>
<strong>Hime</strong><br>
ğŸ”¥ ${Math.round(himeCal)} / ${goals.hime} kcal<br>
ğŸ’§ ${Math.round(himeWater)} ml
`;
}

updateProductList();
updateProductManage();
updateStats();
</script>

</body>
</html>
